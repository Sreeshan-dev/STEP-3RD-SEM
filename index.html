<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>STEP – Weekly Codes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;max-width:820px;margin:28px auto;padding:0 16px}
    h1{margin-bottom:6px} .muted{color:#666;margin-top:0}
    .card{border:1px solid #eee;border-radius:10px;padding:14px;box-shadow:0 2px 8px rgba(0,0,0,.04)}
    ul{padding-left:18px} li{margin:8px 0}
    a.small{font-size:12px;color:#555;margin-left:8px}
  </style>
</head>
<body>
  <h1>STEP — Weekly Codes</h1>
  <p class="muted">Auto-lists Week folders (Practice Problems, Lab, HW) from this repository.</p>

  <div class="card">
    <h3>Weeks</h3>
    <ul id="weeks"><li class="muted">Loading…</li></ul>
  </div>

  <script>
    // Try to auto-detect USER and REPO from URL (works for username.github.io/repo/)
    function detectUserRepo() {
      const host = location.hostname; // username.github.io
      const hostParts = host.split('.');
      let USER = hostParts[0] || '';
      // pathname: /REPO/... -> second part is repo
      const pathParts = location.pathname.split('/').filter(Boolean);
      let REPO = pathParts[0] || '';
      // fallback: ask GitHub API for current repo? We'll just warn if detection fails.
      return {USER, REPO, BRANCH: 'main'};
    }

    const cfg = detectUserRepo();
    // If detection failed (empty), fallback to placeholders (you can replace if needed)
    if (!cfg.USER || !cfg.REPO) {
      // Optional: you can edit these manually if detection doesn't work
      // cfg.USER = "YOUR_USERNAME";
      // cfg.REPO = "YOUR_REPO";
    }

    async function loadWeeks() {
      const ul = document.getElementById('weeks');
      try {
        const res = await fetch(`https://api.github.com/repos/${cfg.USER}/${cfg.REPO}/contents?ref=${cfg.BRANCH}`);
        const items = await res.json();
        if (!Array.isArray(items)) throw new Error('Bad response from GitHub API');

        // directories that look like week folders
        const weekDirs = items.filter(x => x.type === 'dir' && /^week[\s\-_]*\d+/i.test(x.name))
          .sort((a,b)=> {
            const na = parseInt((a.name.match(/\d+/)||[0])[0],10);
            const nb = parseInt((b.name.match(/\d+/)||[0])[0],10);
            return na - nb;
          });

        if (weekDirs.length === 0) {
          ul.innerHTML = '<li class="muted">No Week folders found yet.</li>';
          return;
        }

        ul.innerHTML = '';
        weekDirs.forEach(d => {
          const li = document.createElement('li');
          const a = document.createElement('a');
          a.href = `week.html?dir=${encodeURIComponent(d.name)}`;
          a.textContent = d.name;
          li.appendChild(a);

          const gh = document.createElement('a');
          gh.href = `https://github.com/${cfg.USER}/${cfg.REPO}/tree/${cfg.BRANCH}/${encodeURIComponent(d.name)}`;
          gh.textContent = ' view on GitHub';
          gh.className = 'small';
          gh.target = '_blank';
          li.appendChild(gh);

          ul.appendChild(li);
        });

      } catch (err) {
        ul.innerHTML = `<li class="muted">Error loading weeks. Make sure Pages is enabled and repo is public.</li>`;
        console.error(err);
      }
    }

    loadWeeks();
  </script>
</body>
</html>
